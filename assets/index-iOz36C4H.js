(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function Ut(n){let e=1,t=0,r=0,o=0,i=0,s=!1,c=1;const a=n.getContext("2d");if(!a)throw new Error("Could not get 2d context");const f=a;function h(){f.setTransform(c*e,0,0,c*e,c*t,c*r)}function u(y,w){const E=n.getBoundingClientRect(),M=y-E.left,P=w-E.top;return{x:(M-t)/e,y:(P-r)/e}}function g(y){y.preventDefault();const w=n.getBoundingClientRect(),E=y.clientX-w.left,M=y.clientY-w.top,P=(E-t)/e,k=(M-r)/e,b=y.deltaY>0?.9:1.1,S=Math.max(.1,Math.min(20,e*b));return t=E-P*S,r=M-k*S,e=S,!0}function d(y,w){o=y,i=w,s=!0}function v(y,w){s&&(t+=y-o,r+=w-i,o=y,i=w)}function p(){s=!1}function m(){const y=n.parentElement;if(!y)return;c=window.devicePixelRatio||1;const w=y.clientWidth,E=y.clientHeight;n.width=w*c,n.height=E*c,n.style.width=w+"px",n.style.height=E+"px"}function x(y,w){const E=n.parentElement,M=w?w.width:(E==null?void 0:E.clientWidth)??0,P=w?w.height:(E==null?void 0:E.clientHeight)??0,k=w&&w.centerX!=null?w.centerX:M/2,b=w&&w.centerY!=null?w.centerY:P/2,S=.1,T=20;if(y&&Number.isFinite(y.minX)&&Number.isFinite(y.minY)&&Number.isFinite(y.maxX)&&Number.isFinite(y.maxY)){const O=y.maxX-y.minX,C=y.maxY-y.minY;if(O>0&&C>0){const D=.9*M/O,Q=.9*P/C;e=Math.max(S,Math.min(T,Math.min(D,Q)));const Re=(y.minX+y.maxX)/2,Le=(y.minY+y.maxY)/2;t=k-Re*e,r=b-Le*e;return}}e=1,t=k,r=b}return{get ctx(){return f},get scale(){return e},get tx(){return t},get ty(){return r},applyTransform:h,screenToWorld:u,handleWheel:g,handlePointerDown:d,handlePointerMove:v,handlePointerUp:p,resize:m,resetZoom:x}}function ze(n,e,t={}){if(!e||e.length<2)return;const{fill:r=null,stroke:o="#e94560",lineWidth:i=2}=t;n.beginPath(),n.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)n.lineTo(e[s].x,e[s].y);n.closePath(),r&&(n.fillStyle=r,n.fill()),n.strokeStyle=o,n.lineWidth=i,n.stroke()}function Vt(n,e,t={}){const r=e.x??0,o=e.y??0,i=e.width??e.w??0,s=e.height??e.h??0,{fill:c="rgba(78, 205, 196, 0.35)",stroke:a="#4ecdc4",lineWidth:f=1.5}=t;n.fillStyle=c,n.fillRect(r,o,i,s),n.strokeStyle=a,n.lineWidth=f,n.strokeRect(r,o,i,s)}function Qt(n,e,t={}){const{fill:r="rgba(255, 200, 100, 0.15)",stroke:o="rgba(255, 200, 100, 0.5)",lineWidth:i=1}=t;for(const s of e)ze(n,s,{fill:r,stroke:o,lineWidth:i})}function Gt(n,e,t={}){const{fill:r="rgba(78, 205, 196, 0.35)",stroke:o="#4ecdc4",lineWidth:i=1.5}=t;n.beginPath(),n.arc(e.cx,e.cy,e.r,0,Math.PI*2),r&&(n.fillStyle=r,n.fill()),n.strokeStyle=o,n.lineWidth=i,n.stroke()}function Zt(n,e){return n>e?1:n<e?-1:0}class Ue{constructor(e=Zt,t=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!t}rotateLeft(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}rotateRight(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}_splay(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}splay(e){for(var t,r,o,i,s;e.parent;)t=e.parent,r=t.parent,r&&r.parent?(o=r.parent,o.left===r?o.left=e:o.right=e,e.parent=o):(e.parent=null,this._root=e),i=e.left,s=e.right,e===t.left?(r&&(r.left===t?(t.right?(r.left=t.right,r.left.parent=r):r.left=null,t.right=r,r.parent=t):(i?(r.right=i,i.parent=r):r.right=null,e.left=r,r.parent=e)),s?(t.left=s,s.parent=t):t.left=null,e.right=t,t.parent=e):(r&&(r.right===t?(t.left?(r.right=t.left,r.right.parent=r):r.right=null,t.left=r,r.parent=t):(s?(r.left=s,s.parent=r):r.left=null,e.right=r,r.parent=e)),i?(t.right=i,i.parent=t):t.right=null,e.left=t,t.parent=e)}replace(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,t){var r=this._root,o=null,i=this._compare,s;if(this._noDuplicates)for(;r;){if(o=r,s=i(r.key,e),s===0)return;i(r.key,e)<0?r=r.right:r=r.left}else for(;r;)o=r,i(r.key,e)<0?r=r.right:r=r.left;return r={key:e,data:t,left:null,right:null,parent:o},o?i(o.key,r.key)<0?o.right=r:o.left=r:this._root=r,this.splay(r),this._size++,r}find(e){for(var t=this._root,r=this._compare;t;){var o=r(t.key,e);if(o<0)t=t.right;else if(o>0)t=t.left;else return t}return null}contains(e){for(var t=this._root,r=this._compare;t;){var o=r(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1}remove(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),!t.left)this.replace(t,t.right);else if(!t.right)this.replace(t,t.left);else{var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),!e.left)this.replace(e,e.right);else if(!e.right)this.replace(e,e.left);else{var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}return this._size--,!0}erase(e){var t=this.find(e);if(t){this.splay(t);var r=t.left,o=t.right,i=null;r&&(r.parent=null,i=this.maxNode(r),this.splay(i),this._root=i),o&&(r?i.right=o:this._root=o,o.parent=i),this._size--}}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}next(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,r=[],o=!1,i=0;!o;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),e(t,i++),t=t.right):o=!0;return this}range(e,t,r,o){const i=[],s=this._compare;let c=this._root,a;for(;i.length!==0||c;)if(c)i.push(c),c=c.left;else{if(c=i.pop(),a=s(c.key,t),a>0)break;if(s(c.key,e)>=0&&r.call(o,c))return this;c=c.right}return this}keys(){for(var e=this._root,t=[],r=[],o=!1;!o;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.key),e=e.right):o=!0;return r}values(){for(var e=this._root,t=[],r=[],o=!1;!o;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.data),e=e.right):o=!0;return r}at(e){for(var t=this._root,r=[],o=!1,i=0;!o;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),i===e)return t;i++,t=t.right}else o=!0;return null}load(e=[],t=[],r=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const o=e.length;return r&&qe(e,t,0,o-1,this._compare),this._root=Ke(null,e,t,0,o),this._size=o,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,t,r,o,i){return new Ue(r,i).load(e,t,o)}}function Ke(n,e,t,r,o){const i=o-r;if(i>0){const s=r+Math.floor(i/2),c=e[s],a=t[s],f={key:c,data:a,parent:n};return f.left=Ke(f,e,t,r,s),f.right=Ke(f,e,t,s+1,o),f}return null}function qe(n,e,t,r,o){if(t>=r)return;const i=n[t+r>>1];let s=t-1,c=r+1;for(;;){do s++;while(o(n[s],i)<0);do c--;while(o(n[c],i)>0);if(s>=c)break;let a=n[s];n[s]=n[c],n[c]=a,a=e[s],e[s]=e[c],e[c]=a}qe(n,e,t,c,o),qe(n,e,c+1,r,o)}const F=11102230246251565e-32,A=134217729,en=(3+8*F)*F;function Ae(n,e,t,r,o){let i,s,c,a,f=e[0],h=r[0],u=0,g=0;h>f==h>-f?(i=f,f=e[++u]):(i=h,h=r[++g]);let d=0;if(u<n&&g<t)for(h>f==h>-f?(s=f+i,c=i-(s-f),f=e[++u]):(s=h+i,c=i-(s-h),h=r[++g]),i=s,c!==0&&(o[d++]=c);u<n&&g<t;)h>f==h>-f?(s=i+f,a=s-i,c=i-(s-a)+(f-a),f=e[++u]):(s=i+h,a=s-i,c=i-(s-a)+(h-a),h=r[++g]),i=s,c!==0&&(o[d++]=c);for(;u<n;)s=i+f,a=s-i,c=i-(s-a)+(f-a),f=e[++u],i=s,c!==0&&(o[d++]=c);for(;g<t;)s=i+h,a=s-i,c=i-(s-a)+(h-a),h=r[++g],i=s,c!==0&&(o[d++]=c);return(i!==0||d===0)&&(o[d++]=i),d}function tn(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function de(n){return new Float64Array(n)}const nn=(3+16*F)*F,rn=(2+12*F)*F,on=(9+64*F)*F*F,te=de(4),Ge=de(8),Ze=de(12),et=de(16),B=de(4);function sn(n,e,t,r,o,i,s){let c,a,f,h,u,g,d,v,p,m,x,y,w,E,M,P,k,b;const S=n-o,T=t-o,O=e-i,C=r-i;E=S*C,g=A*S,d=g-(g-S),v=S-d,g=A*C,p=g-(g-C),m=C-p,M=v*m-(E-d*p-v*p-d*m),P=O*T,g=A*O,d=g-(g-O),v=O-d,g=A*T,p=g-(g-T),m=T-p,k=v*m-(P-d*p-v*p-d*m),x=M-k,u=M-x,te[0]=M-(x+u)+(u-k),y=E+x,u=y-E,w=E-(y-u)+(x-u),x=w-P,u=w-x,te[1]=w-(x+u)+(u-P),b=y+x,u=b-y,te[2]=y-(b-u)+(x-u),te[3]=b;let D=tn(4,te),Q=rn*s;if(D>=Q||-D>=Q||(u=n-S,c=n-(S+u)+(u-o),u=t-T,f=t-(T+u)+(u-o),u=e-O,a=e-(O+u)+(u-i),u=r-C,h=r-(C+u)+(u-i),c===0&&a===0&&f===0&&h===0)||(Q=on*s+en*Math.abs(D),D+=S*h+C*c-(O*f+T*a),D>=Q||-D>=Q))return D;E=c*C,g=A*c,d=g-(g-c),v=c-d,g=A*C,p=g-(g-C),m=C-p,M=v*m-(E-d*p-v*p-d*m),P=a*T,g=A*a,d=g-(g-a),v=a-d,g=A*T,p=g-(g-T),m=T-p,k=v*m-(P-d*p-v*p-d*m),x=M-k,u=M-x,B[0]=M-(x+u)+(u-k),y=E+x,u=y-E,w=E-(y-u)+(x-u),x=w-P,u=w-x,B[1]=w-(x+u)+(u-P),b=y+x,u=b-y,B[2]=y-(b-u)+(x-u),B[3]=b;const Re=Ae(4,te,4,B,Ge);E=S*h,g=A*S,d=g-(g-S),v=S-d,g=A*h,p=g-(g-h),m=h-p,M=v*m-(E-d*p-v*p-d*m),P=O*f,g=A*O,d=g-(g-O),v=O-d,g=A*f,p=g-(g-f),m=f-p,k=v*m-(P-d*p-v*p-d*m),x=M-k,u=M-x,B[0]=M-(x+u)+(u-k),y=E+x,u=y-E,w=E-(y-u)+(x-u),x=w-P,u=w-x,B[1]=w-(x+u)+(u-P),b=y+x,u=b-y,B[2]=y-(b-u)+(x-u),B[3]=b;const Le=Ae(Re,Ge,4,B,Ze);E=c*h,g=A*c,d=g-(g-c),v=c-d,g=A*h,p=g-(g-h),m=h-p,M=v*m-(E-d*p-v*p-d*m),P=a*f,g=A*a,d=g-(g-a),v=a-d,g=A*f,p=g-(g-f),m=f-p,k=v*m-(P-d*p-v*p-d*m),x=M-k,u=M-x,B[0]=M-(x+u)+(u-k),y=E+x,u=y-E,w=E-(y-u)+(x-u),x=w-P,u=w-x,B[1]=w-(x+u)+(u-P),b=y+x,u=b-y,B[2]=y-(b-u)+(x-u),B[3]=b;const Jt=Ae(Le,Ze,4,B,et);return et[Jt-1]}function ln(n,e,t,r,o,i){const s=(e-i)*(t-o),c=(n-o)*(r-i),a=s-c;if(s===0||c===0||s>0!=c>0)return a;const f=Math.abs(s+c);return Math.abs(a)>=nn*f?a:-sn(n,e,t,r,o,i,f)}class cn{constructor(e=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,o=t[e];for(;e>0;){const i=e-1>>1,s=t[i];if(r(o,s)>=0)break;t[e]=s,e=i}t[e]=o}_down(e){const{data:t,compare:r}=this,o=this.length>>1,i=t[e];for(;e<o;){let s=(e<<1)+1;const c=s+1;if(c<this.length&&r(t[c],t[s])<0&&(s=c),r(t[s],i)>=0)break;t[e]=t[s],e=s}t[e]=i}}const Pt=0,bt=1,It=2,kt=3,Fe=0,Pe=1,be=2,St=3;function ue(n,e,t){e===null?(n.inOut=!1,n.otherInOut=!0):(n.isSubject===e.isSubject?(n.inOut=!e.inOut,n.otherInOut=e.otherInOut):(n.inOut=!e.otherInOut,n.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(n.prevInResult=!tt(e,t)||e.isVertical()?e.prevInResult:e)),tt(n,t)?n.resultTransition=an(n,t):n.resultTransition=0}function tt(n,e){switch(n.type){case Pt:switch(e){case Fe:return!n.otherInOut;case Pe:return n.otherInOut;case be:return n.isSubject&&n.otherInOut||!n.isSubject&&!n.otherInOut;case St:return!0}break;case It:return e===Fe||e===Pe;case kt:return e===be;case bt:return!1}return!1}function an(n,e){let t=!n.inOut,r=!n.otherInOut,o;switch(e){case Fe:o=t&&r;break;case Pe:o=t||r;break;case St:o=t!==r;break;case be:n.isSubject?o=t&&!r:o=r&&!t;break}return o?1:-1}class ce{constructor(e,t,r,o,i){this.left=t,this.point=e,this.otherEvent=r,this.isSubject=o??!1,this.type=i||Pt,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const t=this.point,r=this.otherEvent.point;return this.left?(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])>0:(r[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(r[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new ce(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function z(n,e){return n[0]===e[0]?n[1]===e[1]:!1}function We(n,e,t){const r=ln(n[0],n[1],e[0],e[1],t[0],t[1]);return r>0?-1:r<0?1:0}function U(n,e){const t=n.point,r=e.point;return t[0]>r[0]?1:t[0]<r[0]?-1:t[1]!==r[1]?t[1]>r[1]?1:-1:un(n,e,t)}function un(n,e,t,r){return n.left!==e.left?n.left?1:-1:We(t,n.otherEvent.point,e.otherEvent.point)!==0?n.isBelow(e.otherEvent.point)?-1:1:!n.isSubject&&e.isSubject?1:-1}function H(n,e,t){const r=new ce(e,!1,n,n.isSubject),o=new ce(e,!0,n.otherEvent,n.isSubject);return z(n.point,n.otherEvent.point)&&console.warn("what is that, a collapsed segment?",n),r.contourId=o.contourId=n.contourId,U(o,n.otherEvent)>0&&(n.otherEvent.left=!0,o.left=!1),n.otherEvent.otherEvent=o,n.otherEvent=r,t.push(o),t.push(r),t}function pe(n,e){return n[0]*e[1]-n[1]*e[0]}function _e(n,e){return n[0]*e[0]+n[1]*e[1]}function fn(n,e,t,r,o){const i=[e[0]-n[0],e[1]-n[1]],s=[r[0]-t[0],r[1]-t[1]];function c(m,x,y){return[m[0]+x*y[0],m[1]+x*y[1]]}const a=[t[0]-n[0],t[1]-n[1]];let f=pe(i,s),h=f*f;const u=_e(i,i);if(h>0){const m=pe(a,s)/f;if(m<0||m>1)return null;const x=pe(a,i)/f;return x<0||x>1?null:m===0||m===1?[c(n,m,i)]:x===0||x===1?[c(t,x,s)]:[c(n,m,i)]}if(f=pe(a,i),h=f*f,h>0)return null;const g=_e(i,a)/u,d=g+_e(i,s)/u,v=Math.min(g,d),p=Math.max(g,d);return v<=1&&p>=0?v===1?[c(n,v>0?v:0,i)]:p===0?[c(n,p<1?p:1,i)]:[c(n,v>0?v:0,i),c(n,p<1?p:1,i)]:null}function Be(n,e,t){const r=fn(n.point,n.otherEvent.point,e.point,e.otherEvent.point),o=r?r.length:0;if(o===0||o===1&&(z(n.point,e.point)||z(n.otherEvent.point,e.otherEvent.point))||o===2&&n.isSubject===e.isSubject)return 0;if(o===1)return!z(n.point,r[0])&&!z(n.otherEvent.point,r[0])&&H(n,r[0],t),!z(e.point,r[0])&&!z(e.otherEvent.point,r[0])&&H(e,r[0],t),1;const i=[];let s=!1,c=!1;return z(n.point,e.point)?s=!0:U(n,e)===1?i.push(e,n):i.push(n,e),z(n.otherEvent.point,e.otherEvent.point)?c=!0:U(n.otherEvent,e.otherEvent)===1?i.push(e.otherEvent,n.otherEvent):i.push(n.otherEvent,e.otherEvent),s&&c||s?(e.type=bt,n.type=e.inOut===n.inOut?It:kt,s&&!c&&H(i[1].otherEvent,i[0].point,t),2):c?(H(i[0],i[1].point,t),3):i[0]!==i[3].otherEvent?(H(i[0],i[1].point,t),H(i[1],i[2].point,t),3):(H(i[0],i[1].point,t),H(i[3].otherEvent,i[2].point,t),3)}function hn(n,e){if(n===e)return 0;if(We(n.point,n.otherEvent.point,e.point)!==0||We(n.point,n.otherEvent.point,e.otherEvent.point)!==0)return z(n.point,e.point)?n.isBelow(e.otherEvent.point)?-1:1:n.point[0]===e.point[0]?n.point[1]<e.point[1]?-1:1:U(n,e)===1?e.isAbove(n.point)?-1:1:n.isBelow(e.point)?-1:1;if(n.isSubject===e.isSubject){let t=n.point,r=e.point;if(t[0]===r[0]&&t[1]===r[1])return t=n.otherEvent.point,r=e.otherEvent.point,t[0]===r[0]&&t[1]===r[1]?0:(n.contourId??0)>(e.contourId??0)?1:-1}else return n.isSubject?-1:1;return U(n,e)===1?1:-1}function gn(n,e,t,r,o,i){const s=new Ue(hn),c=[];let a,f,h;for(;n.length!==0;){let u=n.pop();if(c.push(u),u.left){f=a=s.insert(u),h=s.minNode(),a!==h?a=s.prev(a):a=null,f=s.next(f);const g=a?a.key:null;let d;if(ue(u,g,i),f&&Be(u,f.key,n)===2&&(ue(u,g,i),ue(f.key,u,i)),a&&Be(a.key,u,n)===2){let v=a;v!==h?v=s.prev(v):v=null,d=v?v.key:null,ue(g,d,i),ue(u,g,i)}}else u=u.otherEvent,f=a=s.find(u),a&&f&&(a!==h?a=s.prev(a):a=null,f=s.next(f),s.remove(u),f&&a&&Be(a.key,f.key,n))}return c}class dn{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function pn(n){let e,t,r,o,i;const s=[];for(t=0,r=n.length;t<r;t++)e=n[t],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&s.push(e);let c=!1;for(;!c;)for(c=!0,t=0,r=s.length;t<r;t++)t+1<r&&U(s[t],s[t+1])===1&&(o=s[t],s[t]=s[t+1],s[t+1]=o,c=!1);for(t=0,r=s.length;t<r;t++)e=s[t],e.otherPos=t;for(t=0,r=s.length;t<r;t++)e=s[t],e.left||(i=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=i);return s}function yn(n,e,t,r){let o=n+1,i=e[n].point,s;const c=e.length;for(o<c&&(s=e[o].point);o<c&&s[0]===i[0]&&s[1]===i[1];){if(t[o])o++;else return o;o<c&&(s=e[o].point)}for(o=n-1;t[o]&&o>r;)o--;return o}function mn(n,e,t){const r=new dn;if(n.prevInResult!=null){const o=n.prevInResult,i=o.outputContourId;if(o.resultTransition>0){const s=e[i];if(s.holeOf!=null){const c=s.holeOf;e[c].holeIds.push(t),r.holeOf=c,r.depth=e[i].depth}else e[i].holeIds.push(t),r.holeOf=i,r.depth=e[i].depth+1}else r.holeOf=null,r.depth=e[i].depth}else r.holeOf=null,r.depth=0;return r}function vn(n){let e,t;const r=pn(n),o={},i=[];for(e=0,t=r.length;e<t;e++){if(o[e])continue;const s=i.length,c=mn(r[e],i,s),a=g=>{o[g]=!0,g<r.length&&r[g]&&(r[g].outputContourId=s)};let f=e,h=e;const u=r[e].point;for(c.points.push(u);a(f),f=r[f].otherPos,a(f),c.points.push(r[f].point),f=yn(f,r,o,h),!(f==h||f>=r.length||!r[f]););i.push(c)}return i}const nt=Math.max,rt=Math.min;let ye=0;function ot(n,e,t,r,o,i){let s,c,a,f,h,u;for(s=0,c=n.length-1;s<c;s++){if(a=n[s],f=n[s+1],h=new ce(a,!1,void 0,e),u=new ce(f,!1,h,e),h.otherEvent=u,a[0]===f[0]&&a[1]===f[1])continue;h.contourId=u.contourId=t,i||(h.isExteriorRing=!1,u.isExteriorRing=!1),U(h,u)>0?u.left=!0:h.left=!0;const g=a[0],d=a[1];o[0]=rt(o[0],g),o[1]=rt(o[1],d),o[2]=nt(o[2],g),o[3]=nt(o[3],d),r.push(h),r.push(u)}}function xn(n,e,t,r,o){const i=new cn(void 0,U);let s,c,a,f,h,u;for(a=0,f=n.length;a<f;a++)for(s=n[a],h=0,u=s.length;h<u;h++)c=h===0,c&&ye++,ot(s[h],!0,ye,i,t,c);for(a=0,f=e.length;a<f;a++)for(s=e[a],h=0,u=s.length;h<u;h++)c=h===0,c&&ye++,ot(s[h],!1,ye,i,r,c);return i}const it=[];function wn(n,e,t){let r=null;return n.length*e.length===0&&(r=n.length===0?e:n),r}function En(n,e,t,r,o){let i=null;return(t[0]>r[2]||r[0]>t[2]||t[1]>r[3]||r[1]>t[3])&&(i=n.concat(e)),i}function Mn(n,e,t){let r=n,o=e;typeof n[0][0][0]=="number"&&(r=[n]),typeof e[0][0][0]=="number"&&(o=[e]);let i=wn(r,o);if(i)return i===it?null:i;const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],a=xn(r,o,s,c);if(i=En(r,o,s,c),i)return i===it?null:i;const f=gn(a,r,o,s,c,t),h=vn(f),u=[];for(let g=0;g<h.length;g++){let d=h[g];if(d.isExterior()){let v=[d.points];for(let p=0;p<d.holeIds.length;p++){let m=d.holeIds[p];v.push(h[m].points)}u.push(v)}}return u}function Pn(n,e){return Mn(n,e,Pe)}function ge(n,e,t){if(!t||t.length<3)return!1;let r=!1;const o=t.length;for(let i=0,s=o-1;i<o;s=i++){const c=t[i].x,a=t[i].y,f=t[s].x,h=t[s].y;a>e!=h>e&&n<(f-c)*(e-a)/(h-a)+c&&(r=!r)}return r}function Rt(n,e,t,r,o){const i=Array.isArray(o)?o:o.exterior,s=Array.isArray(o)?[]:o.holes||[],c=[{x:n,y:e},{x:n+t,y:e},{x:n+t,y:e+r},{x:n,y:e+r}];for(const h of c){if(!ge(h.x,h.y,i))return!1;for(const u of s)if(ge(h.x,h.y,u))return!1}const a=[[n,e,n+t,e],[n+t,e,n+t,e+r],[n+t,e+r,n,e+r],[n,e+r,n,e]],f=[i,...s];for(const h of f)for(let u=0,g=h.length;u<g;u++){const d=(u+1)%g,v=h[u].x,p=h[u].y,m=h[d].x,x=h[d].y;for(const[y,w,E,M]of a)if(bn(v,p,m,x,y,w,E,M))return!1}return!0}function bn(n,e,t,r,o,i,s,c){const a=me(n,e,t,r,o,i),f=me(n,e,t,r,s,c),h=me(o,i,s,c,n,e),u=me(o,i,s,c,t,r);return!!(a!==f&&h!==u||a===0&&ve(n,e,t,r,o,i)||f===0&&ve(n,e,t,r,s,c)||h===0&&ve(o,i,s,c,n,e)||u===0&&ve(o,i,s,c,t,r))}function me(n,e,t,r,o,i){const s=(r-e)*(o-t)-(t-n)*(i-r);return s<0?-1:s>0?1:0}function ve(n,e,t,r,o,i){return Math.min(n,t)<=o&&o<=Math.max(n,t)&&Math.min(e,r)<=i&&i<=Math.max(e,r)}function Lt(n){const e=Array.isArray(n)?n:(n==null?void 0:n.exterior)||[];if(!e.length)return{x:0,y:0,w:0,h:0};let t=e[0].x,r=e[0].y,o=t,i=r;for(const s of e)t=Math.min(t,s.x),r=Math.min(r,s.y),o=Math.max(o,s.x),i=Math.max(i,s.y);return{x:t,y:r,w:o-t,h:i-r}}function At(n,e,t,r,o,i){const s=o-t,c=i-r,a=n-t,f=e-r,h=s*s+c*c;let u=h<=0?0:(a*s+f*c)/h;u=Math.max(0,Math.min(1,u));const g=t+u*s,d=r+u*c;return Math.hypot(n-g,e-d)}function In(n,e,t,r){if(!t||t.length<2)return!1;for(let o=0,i=t.length;o<i;o++){const s=(o+1)%i;if(At(n,e,t[o].x,t[o].y,t[s].x,t[s].y)<=r)return!0}return!1}function kn(n,e,t){const r=Array.isArray(t)?t:t.exterior,o=Array.isArray(t)?[]:t.holes||[];let i=1/0;for(const s of[r,...o])for(let c=0,a=s.length;c<a;c++){const f=(c+1)%a,h=At(n,e,s[c].x,s[c].y,s[f].x,s[f].y);i=Math.min(i,h)}return i}function Sn(n,e,t,r){if(t<=0)return!1;const o=Array.isArray(r)?r:r.exterior,i=Array.isArray(r)?[]:r.holes||[];if(!ge(n,e,o))return!1;for(const c of i)if(ge(n,e,c))return!1;return kn(n,e,r)>=t}const Rn=8;function G(n){return`${n.x},${n.y},${n.size}`}function Oe(n){return n.map(e=>({x:e.x,y:e.y,w:e.size,h:e.size}))}function Ln(n,e){const t=Lt(n),r=[];for(let o=0;o*e<t.w;o++)for(let i=0;i*e<t.h;i++){const s=t.x+o*e,c=t.y+i*e;Rt(s,c,e,e,n)&&r.push({x:s,y:c,size:e})}return r}function st(n){return{x:n.x,y:n.y,w:n.w??n.width??0,h:n.h??n.height??0}}function An(n,e){const t=n.length;for(let r=0;r<t;r++){const o=st(n[r]);for(let i=r+1;i<t;i++){const s=st(n[i]);let c=null;if(o.y===s.y&&o.h===s.h&&(o.x+o.w===s.x?c={x:o.x,y:o.y,w:o.w+s.w,h:o.h}:s.x+s.w===o.x&&(c={x:s.x,y:s.y,w:o.w+s.w,h:o.h})),!c&&o.x===s.x&&o.w===s.w&&(o.y+o.h===s.y?c={x:o.x,y:o.y,w:o.w,h:o.h+s.h}:s.y+s.h===o.y&&(c={x:s.x,y:s.y,w:o.w,h:o.h+s.h})),c&&e.some(a=>Rt(c.x,c.y,c.w,c.h,a)))return{i:r,j:i,merged:c}}}return null}function _n(n,e,t,r){const o=n.filter((i,s)=>s!==e&&s!==t);return o.push(r),o}function*_t(n,e,t,r){let o=[];for(const a of n)o=o.concat(Ln(a,e));let i=0;yield{rectangles:Oe(o),remaining:[],iteration:i};const s=new Set(o.map(G)),c=new Set;for(;;){let a=null;if(o.length>0){const p=o[o.length-1];for(const m of Ot(t,r))if(Bt(s,p.x,p.y,p.size,m)){a={x:p.x,y:p.y,size:p.size,k:m};break}}if(!a){const p=new Set(c);o.length>0&&p.add(G(o[o.length-1])),a=jn(s,o,t,r,p)}if(!a)break;const{x:f,y:h,size:u,k:g}=a,d=u*g,v=[];for(let p=0;p<g;p++)for(let m=0;m<g;m++)v.push({x:f+p*u,y:h+m*u,size:u});for(const p of v){const m=G(p);s.delete(m),c.add(m)}s.add(G({x:f,y:h,size:d})),o=o.filter(p=>s.has(G(p))),o.push({x:f,y:h,size:d}),i++,yield{rectangles:Oe(o),remaining:[],iteration:i}}yield{rectangles:Oe(o),remaining:[],iteration:i}}function*Bn(n,e,t,r){const o=Math.max(2,Math.min(1024,Math.floor(t))),i=Math.max(2,Math.min(o,Math.floor(r)));let s={rectangles:[],iteration:0};for(const f of _t(n,e,o,i))yield f,s=f;let c=[...s.rectangles],a=s.iteration;for(;;){const f=An(c,n);if(!f)break;c=_n(c,f.i,f.j,f.merged),a++,yield{rectangles:c,remaining:[],iteration:a}}yield{rectangles:c,remaining:[],iteration:a}}function*On(n,e){let t=Math.floor(n);const r=Math.max(2,Math.floor(e)),o=new Set;for(;t>=r;){o.has(t)||(o.add(t),yield t);const i=Math.floor(t/2);if(i>=t)break;t=i}}function Cn(n,e,t,r){for(const o of r)if(Math.hypot(n-o.cx,e-o.cy)<t+o.r)return!0;return!1}function*Tn(n,e,t,r){const o=[],i=Math.max(2,Math.min(1024,Math.floor(t))),s=Math.max(2,Math.min(i,Math.floor(r)));let c=0;yield{rectangles:[],circles:[],remaining:[],iteration:c};for(const a of On(i,s)){const f=a/2;let h=0;for(const u of n){const g=Lt(u);for(let d=0;;d++){const v=g.x+f+d*a;if(v-f>g.x+g.w)break;for(let p=0;;p++){const m=g.y+f+p*a;if(m-f>g.y+g.h)break;Sn(v,m,f,u)&&(Cn(v,m,f,o)||(o.push({cx:v,cy:m,r:f}),h++))}}}h>0&&(c++,yield{rectangles:[],circles:[...o],remaining:[],iteration:c})}yield{rectangles:[],circles:o,remaining:[],iteration:c}}function Bt(n,e,t,r,o){for(let i=0;i<o;i++)for(let s=0;s<o;s++)if(!n.has(G({x:e+i*r,y:t+s*r,size:r})))return!1;return!0}function jn(n,e,t,r,o){const i=new Map;for(const c of e)o&&o.has(G(c))||(i.has(c.size)||i.set(c.size,[]),i.get(c.size).push(c));const s=[...i.keys()].sort((c,a)=>c-a);for(const c of Ot(t,r))for(const a of s)for(const f of i.get(a)){const{x:h,y:u}=f;if(Bt(n,h,u,a,c))return{x:h,y:u,size:a,k:c}}return null}function*Ot(n,e){let t=Math.floor(n);const r=Math.max(2,Math.floor(e)),o=new Set;for(;t>=r;){o.has(t)||(o.add(t),yield t);const i=Math.floor(t/2);if(i>=t)break;t=i}}function*Nn(n,e={}){const{minSize:t=8,maxK:r=Rn,minK:o=2,shape:i="squares"}=e,s=Math.max(2,Math.min(1024,Math.floor(r))),c=Math.max(2,Math.min(s,Math.floor(o))),a=Ct(n);if(!a||a.length===0){yield{rectangles:[],remaining:[],iteration:0};return}if(i==="rectangles"){yield*Bn(a,t,s,c);return}if(i==="circles"){yield*Tn(a,t,s,c);return}yield*_t(a,t,s,c)}function lt(n){const e=n.map(t=>[t.x,t.y]);return e.length>0&&(e[0][0]!==e[e.length-1][0]||e[0][1]!==e[e.length-1][1])&&e.push([e[0][0],e[0][1]]),[e]}function Ce(n){if(!n||n.length===0)return[];const e=n.map(([t,r])=>({x:t,y:r}));return e.length>1&&e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y&&e.pop(),e.length>=3?e:[]}function He(n){let e=0;for(let t=0,r=n.length;t<r;t++){const o=(t+1)%r;e+=n[t].x*n[o].y-n[o].x*n[t].y}return e/2}function Ct(n){if(!n||n.length===0)return[];if(n.length===1)return[{exterior:n[0],holes:[]}];let e=lt(n[0]);for(let i=1;i<n.length;i++){const s=lt(n[i]),c=Pn(e,s);if(!c)return[];e=c}if(e.length>1&&e.every(i=>i.length===1))return e.map(i=>({exterior:Ce(i[0]),holes:i.slice(1).map(Ce).filter(s=>s.length>0)}));const r=e.map(i=>Ce(i)).filter(i=>i.length>=3);if(r.length===0)return[];const o=r.map(i=>({r:i,a:Math.abs(He(i))}));return o.sort((i,s)=>s.a-i.a),[{exterior:o[0].r,holes:o.slice(1).map(i=>i.r)}]}function Dn(n){if(!n)return 0;const e=n.exterior||[],t=n.holes||[];let r=Math.abs(He(e));for(const o of t)r-=Math.abs(He(o));return Math.max(0,r)}function $n(n){const e=Ct(n);return!e||e.length===0?0:e.reduce((t,r)=>t+Dn(r),0)}const ae=1;function Yn(n,e=null){const t=n?[...n]:[];return e&&e.length>=3&&t.push(e.map(r=>({x:r.x,y:r.y}))),JSON.stringify({type:"polygons",version:ae,data:t},null,2)}function Xn(n){return JSON.stringify(n?{type:"rectangles",version:ae,data:n}:{type:"rectangles",version:ae,data:[]},null,2)}function zn(n){return!n||n.length===0?JSON.stringify({type:"rectangles",version:ae,data:[]},null,2):JSON.stringify({type:"rectangles",version:ae,data:n},null,2)}function Kn(n){if(!n||n.length===0)return{x:0,y:0,w:100,h:100};let e=n[0].x,t=n[0].y,r=n[0].x+(n[0].w??n[0].width??0),o=n[0].y+(n[0].h??n[0].height??0);for(const s of n){const c=s.w??s.width??0,a=s.h??s.height??0;e=Math.min(e,s.x),t=Math.min(t,s.y),r=Math.max(r,s.x+c),o=Math.max(o,s.y+a)}const i=Math.max(r-e,o-t)*.05||10;return{x:e-i,y:t-i,w:r-e+2*i,h:o-t+2*i}}function qn(n){if(!n||n.length===0)return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"></svg>';const e=Kn(n),t=n.map(r=>{const o=r.w??r.width??0,i=r.h??r.height??0;return`<rect x="${r.x}" y="${r.y}" width="${o}" height="${i}" fill="none" stroke="#4ecdc4" stroke-width="1"/>`}).join(`
  `);return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${e.x} ${e.y} ${e.w} ${e.h}">
  ${t}
</svg>`}function Fn(n){const e=n.polygons?[...n.polygons]:[];return n.currentPolygon&&n.currentPolygon.length>=3&&e.push(n.currentPolygon.map(t=>({x:t.x,y:t.y}))),JSON.stringify({type:"session",version:ae,polygons:e,rectangles:n.rectangles||[],circles:n.circles||[]},null,2)}function xe(n){if(!Array.isArray(n))throw new Error("Polygons must be an array");const e=[];for(const t of n){if(!Array.isArray(t))throw new Error("Each polygon must be an array of points");const r=[];for(const o of t){if(o==null||typeof o!="object"||typeof o.x!="number"||typeof o.y!="number")throw new Error("Each point must be { x, y } with numbers");r.push({x:o.x,y:o.y})}r.length>=3&&e.push(r)}return e}function we(n){if(!Array.isArray(n))throw new Error("Rectangles must be an array");const e=[];for(const t of n){if(t==null||typeof t!="object"||typeof t.x!="number"||typeof t.y!="number"||typeof t.w!="number"||typeof t.h!="number")throw new Error("Each rectangle must be { x, y, w, h } with numbers");const r=t;e.push({x:r.x,y:r.y,w:r.w,h:r.h})}return e}function Ee(n){if(!Array.isArray(n))throw new Error("Circles must be an array");const e=[];for(const t of n){if(t==null||typeof t!="object"||typeof t.cx!="number"||typeof t.cy!="number"||typeof t.r!="number")throw new Error("Each circle must be { cx, cy, r } with numbers");const r=t;e.push({cx:r.cx,cy:r.cy,r:r.r})}return e}function Tt(n){if(typeof n!="string"||!n.trim())throw new Error("Empty or invalid input");let e;try{e=JSON.parse(n)}catch(t){throw new Error("Invalid JSON: "+(t instanceof Error?t.message:String(t)))}if(e&&typeof e=="object"&&typeof e.type=="string"){const t=e;switch(t.type){case"polygons":return{polygons:xe(t.data!=null?t.data:[])};case"rectangles":return{rectangles:we(t.data!=null?t.data:[])};case"circles":return{circles:Ee(t.data!=null?t.data:[])};case"session":return{polygons:xe(t.polygons!=null?t.polygons:[]),rectangles:we(t.rectangles!=null?t.rectangles:[]),circles:Ee(t.circles!=null?t.circles:[])};default:throw new Error("Unknown export type: "+t.type)}}if(Array.isArray(e))return{polygons:xe(e)};if(e&&typeof e=="object"){const t=e;if(Array.isArray(t.polygons))return{polygons:xe(t.polygons),rectangles:Array.isArray(t.rectangles)?we(t.rectangles):[],circles:Array.isArray(t.circles)?Ee(t.circles):[]};if(Array.isArray(t.rectangles)&&!Array.isArray(t.polygons))return{rectangles:we(t.rectangles)};if(Array.isArray(t.circles)&&!Array.isArray(t.polygons))return{circles:Ee(t.circles)}}throw new Error('Expected tagged JSON (type: "polygons"|"rectangles"|"circles"|"session") or legacy array / { polygons } / { rectangles }')}const ct=[{id:"rectangle",name:"Rectangle",polygons:[[{x:0,y:0},{x:80,y:0},{x:80,y:60},{x:0,y:60}]]},{id:"lshape",name:"L-shape",polygons:[[{x:0,y:0},{x:80,y:0},{x:80,y:30},{x:40,y:30},{x:40,y:60},{x:0,y:60}]]},{id:"star",name:"Star",polygons:[(()=>{const i=[];for(let s=0;s<10;s++){const c=s%2===0?45:18,a=Math.PI*2*s/10-Math.PI/2;i.push({x:50+c*Math.cos(a),y:50+c*Math.sin(a)})}return i})()]},{id:"hexagon",name:"Hexagon",polygons:[(()=>{const r=[];for(let o=0;o<6;o++){const i=Math.PI*2*o/6-Math.PI/6;r.push({x:60+50*Math.cos(i),y:55+50*Math.sin(i)})}return r})()]},{id:"octagon",name:"Octagon",polygons:[(()=>{const r=[];for(let o=0;o<8;o++){const i=Math.PI*2*o/8-Math.PI/8;r.push({x:55+48*Math.cos(i),y:55+48*Math.sin(i)})}return r})()]},{id:"cross",name:"Cross",polygons:[[{x:35,y:0},{x:85,y:0},{x:85,y:35},{x:120,y:35},{x:120,y:85},{x:85,y:85},{x:85,y:120},{x:35,y:120},{x:35,y:85},{x:0,y:85},{x:0,y:35},{x:35,y:35}]]},{id:"gear",name:"Gear (12-tooth)",polygons:[(()=>{const i=[];for(let s=0;s<24;s++){const c=s%2===0?52:42,a=Math.PI*2*s/24-Math.PI/2;i.push({x:60+c*Math.cos(a),y:60+c*Math.sin(a)})}return i})()]},{id:"house",name:"House",polygons:[[{x:20,y:100},{x:60,y:30},{x:100,y:100},{x:95,y:100},{x:95,y:70},{x:25,y:70},{x:25,y:100}]]},{id:"arrow",name:"Arrow",polygons:[[{x:0,y:45},{x:50,y:45},{x:50,y:20},{x:100,y:55},{x:50,y:90},{x:50,y:65}]]},{id:"ushape",name:"U-shape",polygons:[[{x:0,y:0},{x:100,y:0},{x:100,y:80},{x:60,y:80},{x:60,y:35},{x:40,y:35},{x:40,y:80},{x:0,y:80}]]},{id:"blob",name:"Irregular blob",polygons:[[{x:45,y:5},{x:95,y:25},{x:90,y:55},{x:110,y:85},{x:75,y:95},{x:50,y:75},{x:25,y:90},{x:5,y:60},{x:15,y:35},{x:30,y:20}]]},{id:"star8",name:"8-point star",polygons:[(()=>{const i=[];for(let s=0;s<16;s++){const c=s%2===0?50:22,a=Math.PI*2*s/16-Math.PI/2;i.push({x:55+c*Math.cos(a),y:55+c*Math.sin(a)})}return i})()]}],Ie=document.getElementById("c"),V=document.getElementById("canvas-wrap"),$=document.getElementById("btn-draw"),Te=document.getElementById("btn-close"),je=document.getElementById("btn-new"),R=document.getElementById("btn-run"),Ne=document.getElementById("btn-clear"),De=document.getElementById("btn-reset-zoom"),fe=document.getElementById("btn-undo"),he=document.getElementById("btn-redo"),J=document.getElementById("covering-shape"),oe=document.getElementById("min-size"),Y=document.getElementById("snap-to-grid"),at=document.getElementById("max-k"),ut=document.getElementById("min-k"),X=document.getElementById("speed-preset"),L=document.getElementById("instant-run"),ft=document.getElementById("square-count"),ht=document.getElementById("stats-area"),_=Ut(Ie),l={polygons:[],currentPolygon:null,rectangles:[],circles:[],remaining:[],coveringIteration:0,drawMode:!1,editMode:!1,coveringRunning:!1,coveringPaused:!1,spaceDown:!1,selectedPolygonIndex:null,undoStack:[],redoStack:[]};let W=null,Z=null,ie=null;const jt={slow:200,normal:80,fast:20},Wn=5,Hn=500;function Jn(){const n=(X==null?void 0:X.value)||"normal",e=jt[n]??80;return Math.max(Wn,Math.min(Hn,e))}const Un=12;function K(n){const e=document.getElementById("toast");e&&(e.textContent=n,e.classList.add("show"),clearTimeout(K._tid),K._tid=setTimeout(()=>{e.classList.remove("show")},3e3))}function Vn(n){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(n);const e=document.createElement("textarea");e.value=n,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select();try{return document.execCommand("copy"),Promise.resolve()}finally{document.body.removeChild(e)}}function Nt(n,e,t){const r=new Blob([e],{type:t||"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=n,o.click(),URL.revokeObjectURL(o.href)}function Qn(n,e=3){if(!(n!=null&&n.length))return n;let t=1/0,r=1/0,o=-1/0,i=-1/0;for(const h of n)for(const u of h)t=Math.min(t,u.x),r=Math.min(r,u.y),o=Math.max(o,u.x),i=Math.max(i,u.y);const s=(t+o)/2,c=(r+i)/2,a=Ie.getBoundingClientRect(),f=_.screenToWorld(a.left+a.width/2,a.top+a.height/2);return n.map(h=>h.map(u=>({x:(u.x-s)*e+f.x,y:(u.y-c)*e+f.y})))}function Ve(n,e=null){var t,r,o;if(n.polygons!=null&&(l.polygons=n.polygons,l.currentPolygon=null,l.editMode=!1,l.selectedPolygonIndex=null,l.undoStack=[],l.redoStack=[]),l.rectangles=n.rectangles??[],l.circles=n.circles??[],l.remaining=[],l.coveringIteration=l.rectangles.length>0||l.circles.length>0?1:0,n.polygons==null&&n.rectangles==null&&n.circles==null&&(l.polygons=[],l.currentPolygon=null,l.rectangles=[],l.circles=[],l.remaining=[],l.coveringIteration=0,l.undoStack=[],l.redoStack=[]),I(),j(),N(),e!=null)K(e);else{const i=((t=n.polygons)==null?void 0:t.length)??0,s=((r=n.rectangles)==null?void 0:r.length)??0,c=((o=n.circles)==null?void 0:o.length)??0,a=[];i>0&&a.push(`${i} polygon${i===1?"":"s"}`),s>0&&a.push(`${s} rectangle${s===1?"":"s"}`),c>0&&a.push(`${c} circle${c===1?"":"s"}`),K(a.length?`Imported ${a.join(", ")}`:"Imported (empty)")}}function Gn(n,e,t){return(t??ee())==="circles"&&(e!=null&&e.length)?e.reduce((o,i)=>o+Math.PI*i.r*i.r,0):(n||[]).reduce((o,i)=>o+(i.w??i.width??0)*(i.h??i.height??0),0)}function Dt(){return ee()==="circles"?l.circles.length:l.rectangles.length}function Zn(){let n=l.polygons.length>0?[...l.polygons]:[];return l.currentPolygon&&l.currentPolygon.length>=3&&(n=n.concat([[...l.currentPolygon]])),n}function er(){let n=1/0,e=1/0,t=-1/0,r=-1/0,o=!1;for(const i of l.polygons)for(const s of i)n=Math.min(n,s.x),e=Math.min(e,s.y),t=Math.max(t,s.x),r=Math.max(r,s.y),o=!0;if(l.currentPolygon&&l.currentPolygon.length>=3)for(const i of l.currentPolygon)n=Math.min(n,i.x),e=Math.min(e,i.y),t=Math.max(t,i.x),r=Math.max(r,i.y),o=!0;for(const i of l.rectangles){const s=i.x??0,c=i.y??0,a=i.w??i.width??0,f=i.h??i.height??0;n=Math.min(n,s),e=Math.min(e,c),t=Math.max(t,s+a),r=Math.max(r,c+f),o=!0}for(const i of l.circles)n=Math.min(n,i.cx-i.r),e=Math.min(e,i.cy-i.r),t=Math.max(t,i.cx+i.r),r=Math.max(r,i.cy+i.r),o=!0;return o?{minX:n,minY:e,maxX:t,maxY:r}:null}function ee(){const n=J==null?void 0:J.value;return n==="rectangles"||n==="circles"?n:"squares"}const tr={squares:"Squares",rectangles:"Shapes",circles:"Circles"};function nr(){if(ft){const n=ee(),e=tr[n],t=Dt(),r=t>0?`${e}: ${t}`:`${e}: —`,o=l.coveringRunning||t>0?`Iterations: ${l.coveringIteration}`:"Iterations: —";ft.textContent=`${r}  ·  ${o}`}}function rr(){if(!ht)return;const n=Zn(),e=n.length>0?$n(n):null,t=ee(),r=Gn(l.rectangles,l.circles,t),o=Dt(),i=o>0&&e!=null?e/o:null,s=e!=null&&e>0&&r!=null&&r>0?r/e*100:null,c=s!=null?`${s.toFixed(1)}% coverage`:"Coverage: —",a=e!=null?e.toFixed(1)+" units²":"—",f=r!=null&&r>0?r.toFixed(1)+" units²":"—",h=t==="squares"?"units²/square":"units²/shape",u=i!=null?i.toFixed(1)+" "+h:"—";ht.textContent=`Polygon area: ${a}  ·  Covered area: ${f}  ·  Efficiency: ${u}  ·  ${c}`}function I(){nr(),rr();const n=_.ctx;if(n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,Ie.width,Ie.height),n.restore(),n.save(),_.applyTransform(),n.fillStyle="#0f0f1a",n.fillRect(-1e5,-1e5,2e5,2e5),l.remaining.length>0&&Qt(n,l.remaining),ee()==="circles")for(const t of l.circles)Gt(n,t);else for(const t of l.rectangles)Vt(n,t);for(let t=0;t<l.polygons.length;t++){const r=l.polygons[t],o=t===l.selectedPolygonIndex;ze(n,r,{fill:o?"rgba(78, 205, 196, 0.15)":"rgba(233, 69, 96, 0.08)",stroke:o?"#4ecdc4":"#e94560",lineWidth:o?3:2})}if(l.currentPolygon&&l.currentPolygon.length>0){ze(n,l.currentPolygon,{fill:null,stroke:"#e94560",lineWidth:2});const t=l.currentPolygon[l.currentPolygon.length-1];n.beginPath(),n.arc(t.x,t.y,4,0,Math.PI*2),n.fillStyle="#e94560",n.fill()}n.restore()}function or(n,e){return _.screenToWorld(n,e)}function ir(n,e,t){const r=Math.max(1,t);return{x:Math.round(n/r)*r,y:Math.round(e/r)*r}}function sr(n,e){if(Y!=null&&Y.checked){const t=Math.max(1,Math.min(500,parseInt((oe==null?void 0:oe.value)??"8",10)||8)),r=ir(n,e,t);n=r.x,e=r.y}l.currentPolygon||(l.currentPolygon=[]),l.currentPolygon.push({x:n,y:e}),l.undoStack.push({type:"add_point",point:{x:n,y:e}}),l.redoStack=[],I(),j()}function Qe(){l.currentPolygon&&l.currentPolygon.length>=3&&(l.editMode?(l.polygons.push([...l.currentPolygon]),l.currentPolygon=null,l.editMode=!1):(l.undoStack.push({type:"close_polygon"}),l.redoStack=[],l.polygons.push([...l.currentPolygon]),l.currentPolygon=null),I(),j(),N())}function $t(){l.currentPolygon&&l.currentPolygon.length>=3&&l.polygons.push([...l.currentPolygon]),l.currentPolygon=[],l.editMode=!1,l.selectedPolygonIndex=null,l.undoStack=[],l.redoStack=[],I(),j(),N()}function lr(){W!=null&&(clearTimeout(W),W=null),Z!=null&&(cancelAnimationFrame(Z),Z=null),ie=null,l.polygons=[],l.currentPolygon=null,l.editMode=!1,l.selectedPolygonIndex=null,l.rectangles=[],l.circles=[],l.remaining=[],l.coveringIteration=0,l.coveringRunning=!1,l.coveringPaused=!1,l.undoStack=[],l.redoStack=[],I(),se(),j(),N()}function Yt(){if(l.coveringRunning||l.selectedPolygonIndex==null)return;const n=l.selectedPolygonIndex,e=l.polygons[n];l.undoStack.push({type:"delete_polygon",index:n,points:[...e]}),l.redoStack=[],l.polygons.splice(n,1),l.selectedPolygonIndex=null,I(),j(),N()}function Xt(){if(l.coveringRunning||l.selectedPolygonIndex==null)return;const n=l.selectedPolygonIndex;l.currentPolygon=[...l.polygons[n].map(e=>({x:e.x,y:e.y}))],l.polygons.splice(n,1),l.selectedPolygonIndex=null,l.editMode=!0,l.drawMode=!0,$&&$.classList.add("active"),I(),N()}function j(){fe&&(fe.disabled=l.undoStack.length===0||l.coveringRunning),he&&(he.disabled=l.redoStack.length===0||l.coveringRunning)}function N(){const n=document.getElementById("btn-delete"),e=document.getElementById("btn-edit"),t=l.coveringRunning||l.selectedPolygonIndex==null;n&&(n.disabled=t),e&&(e.disabled=t)}function Je(){var e;if(l.undoStack.length===0||l.coveringRunning)return;const n=l.undoStack.pop();l.redoStack.push(n),n.type==="add_point"?l.currentPolygon&&l.currentPolygon.length>0&&(l.currentPolygon.pop(),(((e=l.currentPolygon)==null?void 0:e.length)??0)===0&&(l.currentPolygon=[])):n.type==="close_polygon"?l.polygons.length>0&&(l.currentPolygon=[...l.polygons.pop()]):n.type==="delete_polygon"&&(l.polygons.splice(n.index,0,n.points),l.selectedPolygonIndex=n.index),I(),j(),N()}function zt(){if(l.redoStack.length===0||l.coveringRunning)return;const n=l.redoStack.pop();l.undoStack.push(n),n.type==="add_point"?(l.currentPolygon||(l.currentPolygon=[]),l.currentPolygon.push(n.point)):n.type==="close_polygon"?l.currentPolygon&&l.currentPolygon.length>=3&&(l.polygons.push([...l.currentPolygon]),l.currentPolygon=null):n.type==="delete_polygon"&&(l.polygons.splice(n.index,1),l.selectedPolygonIndex=null),I(),j(),N()}const Me={play:'<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>',pause:'<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>',computing:'<svg viewBox="0 0 24 24" class="spin"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>'};function se(){if(!R)return;const n=R.querySelector("svg"),e=(L==null?void 0:L.checked)??!1;l.coveringRunning?e?(n&&(n.outerHTML=Me.computing),R.title="Computing…",R.setAttribute("aria-label","Computing"),R.disabled=!0):l.coveringPaused?(n&&(n.outerHTML=Me.play),R.title="Resume (R)",R.setAttribute("aria-label","Resume covering"),R.disabled=!1):(n&&(n.outerHTML=Me.pause),R.title="Pause (R)",R.setAttribute("aria-label","Pause covering"),R.disabled=!1):(n&&(n.outerHTML=Me.play),R.title="Run covering (R)",R.setAttribute("aria-label","Run covering"),R.disabled=!1)}const cr=100;function Kt(){let n=l.polygons.length>0?[...l.polygons]:[];if(l.currentPolygon&&l.currentPolygon.length>=3&&(n=n.concat([[...l.currentPolygon]])),n.length===0)return;l.coveringRunning=!0,l.coveringPaused=!1,l.rectangles=[],l.circles=[],l.remaining=[],l.coveringIteration=0,W=null,Z=null,ie=null;const e=Math.max(1,Math.min(500,parseInt((oe==null?void 0:oe.value)??"8",10)||8)),t=at?Math.max(2,Math.min(1024,parseInt(at.value,10)||8)):8,r=ut?Math.max(2,Math.min(1024,parseInt(ut.value,10)||2)):2,o=ee(),i=Nn(n,{minSize:e,maxK:t,minK:r,shape:o}),s=(L==null?void 0:L.checked)??!1,c=Jn();function a(){l.coveringRunning=!1,l.coveringPaused=!1,W=null,Z=null,ie=null,I(),se(),j(),N()}if(s){let h=function(){if(!l.coveringRunning){a();return}for(let u=0;u<cr;u++){const{value:g,done:d}=i.next();if(d||!l.coveringRunning){if(!d)break;a();return}l.rectangles=g.rectangles??[],l.circles=g.circles??[],l.remaining=g.remaining??[],l.coveringIteration=g.iteration??l.coveringIteration}Z=requestAnimationFrame(h)};se(),Z=requestAnimationFrame(h);return}function f(){if(l.coveringPaused)return;const{value:h,done:u}=i.next();if(u||!l.coveringRunning){a();return}l.rectangles=h.rectangles??[],l.circles=h.circles??[],l.remaining=h.remaining??[],l.coveringIteration=h.iteration??l.coveringIteration,I(),l.coveringPaused||(W=setTimeout(f,c))}ie=f,se(),f()}function qt(){!l.coveringRunning||l.coveringPaused||L!=null&&L.checked||(W!=null&&(clearTimeout(W),W=null),l.coveringPaused=!0,se())}function Ft(){!l.coveringRunning||!l.coveringPaused||(l.coveringPaused=!1,se(),ie&&ie())}V.addEventListener("wheel",n=>{_.handleWheel(n)&&n.preventDefault()},{passive:!1});function ar(n,e){for(let t=l.polygons.length-1;t>=0;t--)if(ge(n,e,l.polygons[t]))return t;return null}V.addEventListener("mousedown",n=>{if(n.button!==0)return;const e=or(n.clientX,n.clientY);if(l.spaceDown){_.handlePointerDown(n.clientX,n.clientY);return}if(l.drawMode&&!l.coveringRunning){l.currentPolygon&&l.currentPolygon.length>=2&&In(e.x,e.y,l.currentPolygon,Un/_.scale)?Qe():sr(e.x,e.y);return}if(!l.coveringRunning){l.selectedPolygonIndex=ar(e.x,e.y),N(),I();return}_.handlePointerDown(n.clientX,n.clientY)});V.addEventListener("mousemove",n=>{if(l.spaceDown){_.handlePointerMove(n.clientX,n.clientY),I();return}_.handlePointerMove(n.clientX,n.clientY),I()});V.addEventListener("mouseup",n=>{n.button===0&&_.handlePointerUp()});V.addEventListener("mouseleave",()=>{_.handlePointerUp()});V.addEventListener("dblclick",n=>{if(n.button===0){if(l.currentPolygon&&l.currentPolygon.length>=3){n.preventDefault(),Qe();return}l.selectedPolygonIndex!=null&&!l.coveringRunning&&(n.preventDefault(),Xt())}});function ur(){var e,t;const n=(t=(e=document.activeElement)==null?void 0:e.tagName)==null?void 0:t.toLowerCase();return n==="input"||n==="textarea"||n==="select"}document.addEventListener("keydown",n=>{var r,o,i,s,c;if(n.code==="Space"){l.spaceDown=!0,V.classList.add("pan");return}if(ur()&&(n.code==="KeyD"||n.code==="KeyR"||n.code==="KeyN"||n.code==="Escape"||n.code==="Backspace"||n.code==="Delete"||n.key==="z"&&(n.metaKey||n.ctrlKey)))return;const e=document.getElementById("help-panel"),t=(r=e==null?void 0:e.classList)==null?void 0:r.contains("open");if(n.code==="Escape"){if(t){n.preventDefault(),e.classList.remove("open");return}if(l.drawMode&&(((o=l.currentPolygon)==null?void 0:o.length)??0)>0){n.preventDefault(),l.currentPolygon=[],l.drawMode=!1,l.editMode=!1,$&&$.classList.remove("active"),l.undoStack=[],l.redoStack=[],I(),j(),N();return}return}if(n.code==="KeyD"){n.preventDefault(),l.drawMode=!l.drawMode,$==null||$.classList.toggle("active",l.drawMode),j();return}if(n.code==="KeyR"){n.preventDefault(),l.coveringRunning?l.coveringPaused?Ft():qt():Kt();return}if(n.code==="KeyN"){n.preventDefault(),$t();return}if(n.code==="Home"){n.preventDefault(),Wt();return}if((n.code==="Delete"||n.code==="Backspace")&&!l.coveringRunning){const a=l.undoStack[l.undoStack.length-1];if(l.drawMode&&(((i=l.currentPolygon)==null?void 0:i.length)??0)>0&&(a==null?void 0:a.type)==="add_point"){n.preventDefault(),Je();return}if(l.selectedPolygonIndex!=null){const f=(c=(s=document.activeElement)==null?void 0:s.tagName)==null?void 0:c.toLowerCase();f!=="input"&&f!=="textarea"&&(n.preventDefault(),Yt())}return}n.key==="z"&&(n.metaKey||n.ctrlKey)&&!l.coveringRunning&&(n.preventDefault(),n.shiftKey?zt():Je())});document.addEventListener("keyup",n=>{n.code==="Space"&&(l.spaceDown=!1,V.classList.remove("pan"),_.handlePointerUp())});$==null||$.addEventListener("click",()=>{l.drawMode=!l.drawMode,$.classList.toggle("active",l.drawMode),j()});Te==null||Te.addEventListener("click",Qe);fe==null||fe.addEventListener("click",Je);he==null||he.addEventListener("click",zt);je==null||je.addEventListener("click",$t);const $e=document.getElementById("btn-delete"),Ye=document.getElementById("btn-edit");$e==null||$e.addEventListener("click",Yt);Ye==null||Ye.addEventListener("click",Xt);R==null||R.addEventListener("click",()=>{l.coveringRunning?l.coveringPaused?Ft():qt():Kt()});Ne==null||Ne.addEventListener("click",lr);function Wt(){const n=er(),e=document.getElementById("canvas-wrap");let t;if(e){const r=e.getBoundingClientRect();t={width:r.width,height:r.height,centerX:r.width/2,centerY:r.height/2}}_.resetZoom(n,t),I()}De==null||De.addEventListener("click",Wt);const q=document.getElementById("export-dropdown"),gt=document.getElementById("btn-export");gt&&q&&(gt.addEventListener("click",n=>{n.stopPropagation(),q.classList.toggle("open")}),document.addEventListener("click",()=>q==null?void 0:q.classList.remove("open")));const ne=document.getElementById("samples-dropdown"),dt=document.getElementById("btn-samples"),Xe=document.getElementById("samples-menu");if(dt&&ne&&Xe){for(const n of ct){const e=document.createElement("button");e.type="button",e.textContent=n.name,e.dataset.presetId=n.id,Xe.appendChild(e)}dt.addEventListener("click",n=>{n.stopPropagation(),ne.classList.toggle("open")}),Xe.addEventListener("click",n=>{const t=n.target.closest("button[data-preset-id]");if(!t)return;const r=ct.find(o=>o.id===t.dataset.presetId);if(r){const o=Qn(r.polygons);Ve({polygons:o,rectangles:[]},`Loaded: ${r.name}`),ne.classList.remove("open")}}),document.addEventListener("click",()=>ne==null?void 0:ne.classList.remove("open"))}const pt=document.getElementById("btn-help"),re=document.getElementById("help-panel");pt&&re&&(pt.addEventListener("click",n=>{n.stopPropagation(),re.classList.toggle("open")}),re.addEventListener("click",n=>n.stopPropagation()),document.addEventListener("click",()=>re==null?void 0:re.classList.remove("open")));function ke(n,e,t,r){const o=n();Vn(o).then(()=>K(r?`Copied ${r}`:"Copied to clipboard"),()=>{Nt(e,o,t),K("Downloaded "+e)}),q&&q.classList.remove("open")}var yt;(yt=document.getElementById("export-polygons-json"))==null||yt.addEventListener("click",()=>{ke(()=>Yn(l.polygons,l.currentPolygon),"polygons.json","application/json","polygons (JSON)")});var mt;(mt=document.getElementById("export-rectangles-json"))==null||mt.addEventListener("click",()=>{ke(()=>Xn(l.rectangles),"rectangles.json","application/json","rectangles (JSON)")});var vt;(vt=document.getElementById("export-rectangles-code"))==null||vt.addEventListener("click",()=>{ke(()=>zn(l.rectangles),"rectangles.json","application/json","rectangles (code)")});var xt;(xt=document.getElementById("export-rectangles-svg"))==null||xt.addEventListener("click",()=>{const n=qn(l.rectangles);Nt("rectangles.svg",n,"image/svg+xml"),K("Downloaded rectangles.svg"),q&&q.classList.remove("open")});var wt;(wt=document.getElementById("export-all-json"))==null||wt.addEventListener("click",()=>{ke(()=>Fn(l),"session.json","application/json","session (polygons + rectangles)")});const le=document.getElementById("import-file");var Et;(Et=document.getElementById("btn-import"))==null||Et.addEventListener("click",()=>le==null?void 0:le.click());le==null||le.addEventListener("change",n=>{var o;const e=n.target,t=(o=e.files)==null?void 0:o[0];if(!t)return;const r=new FileReader;r.onload=()=>{try{const i=Tt(r.result);Ve(i)}catch(i){K("Import failed: "+(i instanceof Error?i.message:String(i)))}e.value=""},r.readAsText(t)});var Mt;(Mt=document.getElementById("btn-import-paste"))==null||Mt.addEventListener("click",async()=>{var n;try{const e=(n=navigator.clipboard)!=null&&n.readText?await navigator.clipboard.readText():"";if(!e.trim()){K("Clipboard empty or paste not allowed");return}const t=Tt(e);Ve(t)}catch(e){K("Import failed: "+(e instanceof Error?e.message:String(e)))}});window.addEventListener("resize",()=>{_.resize(),I()});const Ht="poly-covering-prefs";function fr(){try{const n=localStorage.getItem(Ht);if(!n)return;const e=JSON.parse(n);X&&e.speed&&jt[e.speed]!=null&&(X.value=e.speed),L&&typeof e.instantRun=="boolean"&&(L.checked=e.instantRun),Y&&typeof e.snapToGrid=="boolean"&&(Y.checked=e.snapToGrid),J&&["squares","rectangles","circles"].includes(e.shape??"")&&(J.value=e.shape)}catch{}}function Se(){try{const n={speed:(X==null?void 0:X.value)||"normal",instantRun:(L==null?void 0:L.checked)??!1,snapToGrid:(Y==null?void 0:Y.checked)??!1,shape:ee()};localStorage.setItem(Ht,JSON.stringify(n))}catch{}}fr();X==null||X.addEventListener("change",Se);L==null||L.addEventListener("change",Se);Y==null||Y.addEventListener("change",Se);J==null||J.addEventListener("change",Se);_.resize();I();j();N();
